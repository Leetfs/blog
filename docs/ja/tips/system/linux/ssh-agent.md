---
title: ssh エージェント転送
author: Lee
---

## 使用シナリオ

開発中にリモートサーバーでSSHキーをより安全に利用するため、サーバー上に直接キーを保存するのではなく、SSHエージェント転送を通じてローカルのキーを利用することを推奨します。これにより、鍵の漏洩リスクを効果的に回避し、全体のセキュリティを向上させます。

## 設定

### ローカル設定の確認

まずローカルのsshが正常に動作していることを確認してください。`ssh-add -l` コマンドで全てのsshキーを一覧表示でき、また `ssh -T` を実行して正しくアクセスできるかテストしてください。

![](/tips/system/linux/pubilc/ssh-agent-1.png)

### ssh エージェント転送の設定

`ユーザーフォルダ/.ssh/config` ファイルを開き、sshエージェント転送を有効にしたいサーバー設定の下に `ForwardAgent yes` を追加してください。

例：

```text{4}
Host テストサーバー
  HostName サーバーアドレスはこちら
  User root
  ForwardAgent yes
```

この方法で全体に有効化することも可能です：

```text
Host *
  ForwardAgent yes
```

設定後、サーバー側で `ssh-add -l` を実行して全てのsshキーを表示できます。有効でない場合は、サーバー側の `etc/ssh/sshd_config` ファイル内の `AllowAgentForwarding` オプションが `yes` になっているかを確認してください。

### セキュリティの注意

:::warning
サーバーが直接鍵にアクセスできるわけではありませんが、接続が確立されると、同様に鍵を使用できるため、信頼できるサーバーのみ追加するか、1password agent などの二要素認証が必要な方法で安全性を確保してください。
:::
